name: CI - Quotes Project

on:
  push:
    paths:
      - 'QUOTES.md'
      - 'update-quote.js'
      - 'README.md'
  pull_request:
    paths:
      - 'QUOTES.md'
      - 'update-quote.js'
      - 'README.md'

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18

      - run: npm install lodash

      - name: Skip check for repository owner
        if: github.actor == 'pryge'
        run: echo "Author is pryge — skipping verification."

      - name: Check quotes.brain.js
        if: github.actor != 'pryge'
        run: node quotes.brain.js --dry-run || exit 1

      - name: Check quotes format
        if: github.actor != 'pryge'
        run: |
          errors=0
          while IFS= read -r line
          do
            if [[ -n "$line" && "$line" != -* ]]; then
              echo "❌ Invalid line in QUOTES.md: $line"
              errors=$((errors+1))
            fi
          done < QUOTES.md

          if [ $errors -gt 0 ]; then
            exit 1
          else
            echo "✅ All quotes are properly formatted"
          fi